
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Creating Email Accounts on Your Domain Dynamically - Shivam Daryanani's Blog</title>
  <meta name="author" content="Shivam Daryanani">

  
  <meta name="description" content="For an app I am working on, I needed to create an email account on my domain based on the user&rsquo;s input. For example the user signed up as & &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://shivamd.github.io/blog/2013/11/14/creating-email-accounts-on-your-domain-dynamically">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Shivam Daryanani's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Shivam Daryanani's Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:shivamd.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Creating Email Accounts on Your Domain Dynamically</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-14T09:40:00+04:00" pubdate data-updated="true">Nov 14<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>For an app I am working on, I needed to create an email account on my domain based on the user&rsquo;s input. For example the user signed up as &lsquo;johndoe&rsquo;, I had to create an email for them <a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#x3a;&#106;&#111;&#104;&#110;&#100;&#x6f;&#x65;&#64;&#109;&#121;&#100;&#111;&#109;&#97;&#x69;&#110;&#x2e;&#99;&#x6f;&#109;&#x2e;">&#106;&#x6f;&#x68;&#110;&#x64;&#111;&#x65;&#64;&#109;&#121;&#100;&#111;&#x6d;&#97;&#105;&#110;&#x2e;&#99;&#111;&#109;&#46;</a> Initially I thought this would be difficult, but it turned out to be simple thanks to <a href="http://dnsimple.com">DNSimple</a>.</p>

<h3>Attempt#1</h3>

<p>After searching stackoverflow for a few hours, I posted a <a href="http://stackoverflow.com/questions/19866040/how-to-create-an-email-address-on-your-domain-dynamically">question</a> on asking how can this be done. Thanks to <a href="http://stackoverflow.com/users/1385773/ludovic">Ludovic</a> who mentioned I can use the API of my host service. I didn&rsquo;t know it would be that easy and luckily my host service, <a href="http://www.namecheap.com/">Namecheap</a>, has an <a href="http://developer.namecheap.com/docs/">API</a>. I signed up for a key and within 24 hours got access to it. I was able to <a href="http://developer.namecheap.com/docs/doku.php?id=api-reference:domains.dns:setcustom">set up email forwarding</a>, but due to the API being in beta stage there are a few caveats. First the API is only available during specific hours, which wasn&rsquo;t too bad. However the API was expected to be used through a set IP address and this was a deal breaker. In order to get this up on Heroku meant using the <a href="https://addons.heroku.com/proximo">Proximo</a> addon which is too expensive for my budget. I scraped this and starting looking for an easier way.</p>

<h3>DNSimple To The Rescue</h3>

<p>I had heard a lot of about DNSimple and their ease on managing domain settings. This topic always confuses me, but their brilliant UI and well documented options make it very easy to use. The best part was they have a full featured <a href="http://developer.dnsimple.com/">API</a> which is exactly what I needed. DNSimple comes with a 30day trial, but I signed up for their bronze plan. The request needed to get all email forwards for you app:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl  -H <span class="s1">&#39;X-DNSimple-Token: youraddress@gmail.com:APIToken&#39;</span> <span class="se">\</span>
</span><span class='line'>      -H <span class="s1">&#39;Accept: application/json&#39;</span> <span class="se">\</span>
</span><span class='line'>      https://dnsimple.com/domains/example.com/email_forwards
</span></code></pre></td></tr></table></div></figure>


<p>This is a get request with the headers notifying that you want a JSON response and a header specifying your email and API token. You can obtain your API token from the <a href="https://dnsimple.com/account">account page</a>, don&rsquo;t confuse this with the domain key that DNSimple provides.
In order to create an email forward, you will need to make a post request:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl  -H <span class="s1">&#39;X-DNSimple-Token: youraddress@gmail.com:APIToken&#39;</span> <span class="se">\</span>
</span><span class='line'>      -H <span class="s1">&#39;Accept: application/json&#39;</span> <span class="se">\</span>
</span><span class='line'>      -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\</span>
</span><span class='line'>      -X POST <span class="se">\</span>
</span><span class='line'>      -d <span class="s1">&#39;{</span>
</span><span class='line'><span class="s1">          &quot;email_forward&quot;: {</span>
</span><span class='line'><span class="s1">            &quot;from&quot;: &quot;john&quot;,</span>
</span><span class='line'><span class="s1">            &quot;to&quot;: &quot;someone@example.com&quot;</span>
</span><span class='line'><span class="s1">          }</span>
</span><span class='line'><span class="s1">      }&#39;</span> <span class="se">\</span>
</span><span class='line'>      https://dnsimple.com/domains/example.com/email_forward
</span></code></pre></td></tr></table></div></figure>


<p>This time we have an additional header, setting the content-type to be JSON as we will be sending JSON. We also need to specify a post request, which is indicated by -X. Finally we have to send the data with -d. All emails that get sent to <a href="&#109;&#97;&#x69;&#108;&#116;&#111;&#58;&#106;&#111;&#104;&#110;&#x40;&#x65;&#120;&#97;&#x6d;&#112;&#108;&#x65;&#46;&#99;&#x6f;&#x6d;">&#x6a;&#111;&#104;&#110;&#64;&#101;&#120;&#x61;&#x6d;&#x70;&#108;&#x65;&#x2e;&#99;&#x6f;&#x6d;</a> will be forwarded to <a href="&#109;&#x61;&#x69;&#108;&#x74;&#111;&#58;&#115;&#111;&#x6d;&#101;&#111;&#x6e;&#x65;&#64;&#101;&#x78;&#97;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#111;&#x6d;&#46;">&#115;&#x6f;&#109;&#x65;&#x6f;&#x6e;&#x65;&#x40;&#101;&#x78;&#97;&#x6d;&#x70;&#x6c;&#x65;&#x2e;&#99;&#111;&#x6d;&#x2e;</a></p>

<p>You can send a post request with headers in a Rails app using the <code>system</code> method(you&rsquo;ll paste in the same script)  but I prefer to make a post request using the <a href="https://github.com/jnunemaker/httparty">HTTParty</a> gem as it&rsquo;s cleaner. The same post request in ruby:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://dnsimple.com/domains/example.com/email_forwards&quot;</span>
</span><span class='line'><span class="no">HTTParty</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">body</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;email_forward&quot;</span> <span class="o">=&gt;</span>
</span><span class='line'>                           <span class="p">{</span>
</span><span class='line'>                             <span class="s2">&quot;from&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;john&quot;</span><span class="p">,</span>
</span><span class='line'>                              <span class="s2">&quot;to&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;someone@example.com&quot;</span>
</span><span class='line'>                           <span class="p">}</span>
</span><span class='line'>                    <span class="p">}</span><span class="o">.</span><span class="n">to_json</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">headers</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                        <span class="s1">&#39;X-DNSimple-Token&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;youraddress@gmail.com:APIToken&#39;</span><span class="p">,</span>
</span><span class='line'>                        <span class="s1">&#39;Accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span class='line'>                        <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span class='line'>                       <span class="p">}</span>
</span><span class='line'>             <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>That will create the same result as the script above,  don&rsquo;t forget to call <code>to_json</code> on the body.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Shivam Daryanani</span></span>

      








  


<time datetime="2013-11-14T09:40:00+04:00" pubdate data-updated="true">Nov 14<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/dns/'>dns</a>, <a class='category' href='/blog/categories/domain/'>domain</a>, <a class='category' href='/blog/categories/rails/'>rails</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://shivamd.github.io/blog/2013/11/14/creating-email-accounts-on-your-domain-dynamically/" data-via="" data-counturl="http://shivamd.github.io/blog/2013/11/14/creating-email-accounts-on-your-domain-dynamically/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/11/09/create-dynamic-cron-jobs-in-rails/" title="Previous Post: Creating Dynamic Cron Jobs in Rails">&laquo; Creating Dynamic Cron Jobs in Rails</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/11/16/harnessing-the-power-of-ctags-in-vim/" title="Next Post: Harnessing the Power of Ctags in Vim">Harnessing the Power of Ctags in Vim &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/11/16/harnessing-the-power-of-ctags-in-vim/">Harnessing the Power of Ctags in Vim</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/14/creating-email-accounts-on-your-domain-dynamically/">Creating Email Accounts on Your Domain Dynamically</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/09/create-dynamic-cron-jobs-in-rails/">Creating Dynamic Cron Jobs in Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/07/receiving-email-in-a-rails-app/">Receiving Email in a Rails App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/03/nested-attributes-in-rails-4/">Nested Attributes in Rails 4</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Shivam Daryanani -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'shivamd';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://shivamd.github.io/blog/2013/11/14/creating-email-accounts-on-your-domain-dynamically/';
        var disqus_url = 'http://shivamd.github.io/blog/2013/11/14/creating-email-accounts-on-your-domain-dynamically/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
