<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Shivam Daryanani's Blog]]></title>
  <link href="http://shivamd.github.io/atom.xml" rel="self"/>
  <link href="http://shivamd.github.io/"/>
  <updated>2013-11-03T09:14:24+04:00</updated>
  <id>http://shivamd.github.io/</id>
  <author>
    <name><![CDATA[Shivam Daryanani]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Facebook Realtime Updates in a Rails Application]]></title>
    <link href="http://shivamd.github.io/blog/2013/11/03/facebook-realtime-updates/"/>
    <updated>2013-11-03T00:01:00+04:00</updated>
    <id>http://shivamd.github.io/blog/2013/11/03/facebook-realtime-updates</id>
    <content type="html"><![CDATA[<p>Since Facebook has rolled out realtime updates it has been easier to gather information. Instead of hitting the API on a set time interval, we can just wait for Facebook to ping us and go grab the information we need. This all sounds good in theory but as I had to integrate realtime updates for an application I am working on, there were quite a few pitfalls and I wish I knew some of these before hand.</p>

<h3>Setting up a Facebook application</h3>

<p>I am not going to walk you through creating a Facebook application, <a href="http://railscasts.com/episodes/360-facebook-authentication?view=asciicast">Ryan Bates</a> already does a good job with it. Once you have that setup and the permissions you need for this application head over to your <a href="https://developers.facebook.com/apps">Facebook applications</a> dashboard. Over here select the application in which you would like to enable realtime updates and hit the edit button on the top right. This should take you to a page with the basic information of your application, and on the right under settings there should be &lsquo;realtime updates&rsquo;.</p>

<p><img class="center" src="http://shivamd.github.io/images/realtime_settings.png"></p>

<p>As you can see I have a user object and the fields I want to follow. I have selected all the fields for the demo. You should only select the fields your app has permissions for, otherwise it would be pointless as you won&rsquo;t be able to get the information.
For the callback URL you should point it to the route of the realtime action, but you must be thinking how will I test this locally? That&rsquo;s where <a href="https://ngrok.com/">Ngrok</a> comes in. Ngrok creates a tunnel from the public internet to a port on your local machine. This is perfect for a situation like this where Facebook has to verify that you are authorized.
The information on the site is self explanatory, once installed have it listen to the same port as your server.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails s -p 3000
</span><span class='line'><span class="c"># on a different Terminal window</span>
</span><span class='line'>path/to/ngrok 3000
</span></code></pre></td></tr></table></div></figure>


<p>Ngrok will give you a URL which you can paste in to the callback section followed by the route to the realtime action. For the verify token any random string will do.</p>

<h3>Setting up the controller</h3>

<p>Now create a facebook controller with the real_time method.</p>

<figure class='code'><figcaption><span>app/controllers/facebook_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>   <span class="k">def</span> <span class="nf">real_time</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;hub.mode&#39;</span><span class="o">]</span> <span class="o">==</span><span class="s1">&#39;subscribe&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;hub.verify_token&#39;</span><span class="o">]</span> <span class="o">==</span><span class="s1">&#39;stringToken&#39;</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;hub.challenge&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;Failed to authorize facebook challenge request&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span>
</span><span class='line'>      <span class="c1">#do stuff with information </span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the routes should look like this:</p>

<figure class='code'><figcaption><span>config/routes.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>    <span class="n">namespace</span> <span class="ss">:facebook</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">match</span> <span class="s2">&quot;/real_time&quot;</span><span class="p">,</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="ss">:real_time</span><span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="s1">&#39;facebook_subscription&#39;</span><span class="p">,</span> <span class="ss">:via</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:get</span><span class="p">,</span><span class="ss">:post</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have the route set up for both GET&amp;POST, when we click on test on the realtime updates page Facebook will make a get request to this route ensuring we are authorized. The default hub.mode set by Facebook is subscribe and you must make sure that the verify_token matches what you have entered on Facebook. If all went well Facebook will prompt you with the following message:</p>

<p><img class="center" src="http://shivamd.github.io/images/realtime_success.png"></p>

<h3>And we are done&hellip;not really.</h3>

<p>Your application is running, realtime updates are setup and you have a test account to play around with. On every change the user makes to the field you have subscribed to, Facebook will ping your servers. However it will only do so with the Facebook ID, the fields that have changed and a timestamp. This means that we still have to query the API and this can be quite a pain when it comes to things like comments or photos. The good thing is I have banged my head on this for the past week and should be able to alleviate a lot of your troubles.</p>

<p>Facebook example response for relationship change:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;relationship_status&quot;</span><span class="p">,</span> <span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;facebook&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;relationship_status&quot;</span><span class="p">,</span> <span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now in order to actually grab the change we have to make a call to the Facebook API requesting this information. You will only be able to get this information if you have the right permissions.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1">#you&#39;ll need the HTTParty gem</span>
</span><span class='line'>  <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://graph.facebook.com/</span><span class="si">#{</span><span class="n">uid</span><span class="si">}</span><span class="s2">?fields=relationship_status&amp;access_token=&quot;</span> <span class="o">+</span> <span class="n">auth_token</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This gives the information for the relationship status. This seems and is straight forward and these are the building pieces for every change. However there are some caveats. Below are snippets in order to get events,friends,posts,photos&amp;comments.</p>

<h3>Events</h3>

<p>Facebook example response for events change:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;facebook&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the query to get all event ID&rsquo;s and the respective information:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1">#where token is the user&#39;s auth token</span>
</span><span class='line'>  <span class="n">event_ids</span> <span class="o">=</span> <span class="ss">FbGraph</span><span class="p">:</span><span class="ss">:Query</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;SELECT eid, rsvp_status FROM event_member WHERE uid = </span><span class="si">#{</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="n">token</span><span class="p">)</span>
</span><span class='line'>  <span class="n">event_ids</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">event_id</span><span class="o">|</span>
</span><span class='line'>    <span class="n">event_info</span> <span class="o">=</span> <span class="ss">FbGraph</span><span class="p">:</span><span class="ss">:Query</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;SELECT creator, eid, all_members_count, attending_count, not_replied_count, declined_count, unsure_count, privacy, host, location, name, description, venue, pic, start_time, end_time FROM event WHERE eid=</span><span class="si">#{</span><span class="n">event_id</span><span class="o">[</span><span class="s1">&#39;eid&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="n">token</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Friends</h3>

<p>Facebook example response for friends change:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;friends&quot;</span><span class="p">,</span> <span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;facebook&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;friends&quot;</span><span class="p">,</span> <span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the query to get all friend&rsquo;s related information:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#token is the user&#39;s auth token</span>
</span><span class='line'><span class="n">friends</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://graph.facebook.com/&quot;</span> <span class="o">+</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;/friends?access_token=&quot;</span> <span class="o">+</span> <span class="n">token</span> <span class="o">+</span> <span class="s2">&quot;&amp;fields=birthday,age_range,gender,first_name,last_name,name,id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s2">&quot;data&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">friends</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">friend</span><span class="o">|</span>
</span><span class='line'>  <span class="n">friend_data</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://graph.facebook.com/&quot;</span> <span class="o">+</span> <span class="n">friend</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span> <span class="o">+</span> <span class="s2">&quot;?access_token=&quot;</span> <span class="o">+</span> <span class="n">token</span> <span class="o">+</span> <span class="s2">&quot;&amp;fields=about,age_range,birthday,link,bio,events,gender,interested_in,location,name,relationship_status,significant_other,first_name,interested_in,last_name,locale,location,username,family,likes,locations,movies,picture,photos,posts,security_settings&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parsed_response</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Posts,Photos&amp;Comments</h3>

<p>Now this is where things start to get complicated. As you can see Facebook sends &lsquo;feed&rsquo; as a changed field with every column.With every change to anything on Facebook it needs to update the feed and in order to get the photos,posts and comments we must query the feed or stream in the Facebook Query Language. Despite being able to get posts on the &lsquo;status&rsquo; changed field and photos on the &lsquo;photos&rsquo; changed field, I found it best to look for the feed change and make a query.</p>

<p>One great thing with the Facebook Query Language is that you can add conditions to your queries.When making a query after a realtime update, you can put a conditional for updated time to be just before the timestamp given by Facebook.That&rsquo;s what I thought too, but after a lot of digging Facebook doesn&rsquo;t give you the right information. The only way around this is to get all the posts, sort them by updated time and then use ruby&rsquo;s built in methods to select the posts before a certain time.</p>

<p>Facebook example response for feed:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#as you can see it gives us the time</span>
</span><span class='line'><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;facebook&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="o">=&gt;[</span><span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;100928374283421&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="o">=&gt;</span><span class="mi">1383426584</span><span class="p">,</span> <span class="s2">&quot;changed_fields&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;feed&quot;</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the query to get the latest posts:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'><span class="n">latest_posts</span> <span class="o">=</span> <span class="ss">FbGraph</span><span class="p">:</span><span class="ss">:Query</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;SELECT comment_info,post_id,message,actor_id,attachment,is_hidden,like_info,message_tags,permalink,privacy,created_time,updated_time,share_count,target_id,type,with_tags from stream WHERE source_id=me() and (message or attachment) ORDER BY updated_time DESC LIMIT 100&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">access_token</span><span class="ss">:token</span><span class="p">)</span>
</span><span class='line'><span class="n">posts</span> <span class="o">=</span> <span class="n">latest_posts</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="n">post</span><span class="o">[</span><span class="s2">&quot;updated_time&quot;</span><span class="o">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">time</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="n">post</span><span class="o">[</span><span class="s2">&quot;message&quot;</span><span class="o">].</span><span class="n">present?</span> <span class="o">||</span> <span class="n">post</span><span class="o">[</span><span class="s2">&quot;attachment&quot;</span><span class="o">][</span><span class="s2">&quot;media&quot;</span><span class="o">]</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What&rsquo;s going on here? In the first query, I find all the posts of the user limit them to 100, order them by updated time and make sure that either message or attachment(photo) is present. In the next line I take only the posts that have an updated time 30 seconds(approximate time it takes Facebook to ping your servers) before the timestamp. And select the ones that either have a message or photos. Now we have a bunch of posts, time to decipher whether it is a status update, photo or comment.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#posts from the previous codeblock </span>
</span><span class='line'><span class="n">posts</span><span class="o">.</span><span class="n">each</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">post</span><span class="o">[</span><span class="s2">&quot;message&quot;</span><span class="o">].</span><span class="n">present?</span>
</span><span class='line'>    <span class="c1">#create post</span>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">post</span><span class="o">[</span><span class="s2">&quot;attachment&quot;</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">post</span><span class="o">[</span><span class="s2">&quot;attachment&quot;</span><span class="o">][</span><span class="s2">&quot;media&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="c1">#create photo with post[&quot;attachment&quot;][&quot;media&quot;] passed as a parameter</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The post is fairly simple from here, we already have the attributes we need. Now in order to get comments for post, we can do the following query:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#you can sort by time if needed </span>
</span><span class='line'><span class="n">comments</span> <span class="o">=</span> <span class="ss">FbGraph</span><span class="p">:</span><span class="ss">:Query</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;SELECT id, user_likes, text, post_id, fromid, likes, time FROM comment WHERE post_id = &#39;</span><span class="si">#{</span><span class="n">post_id</span><span class="si">}</span><span class="s2">&#39; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">access_token</span><span class="ss">:token</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The use case for me is to update all the comments for the posts and add the new ones, hence I query for all of them. Facebook gives you the flexibility with the query language for any use case possible. Posts,and comments done and now time for photos.
After rigourous testing, Facebook gives only 9 photos. Let&rsquo;s say a user added an album, added 50 photos to this with normal queries that I am about to display Facebook will only give 9 photos back. The worst part is there&rsquo;s no way to decipher if there are more photos. One trick I found is, if Facebook gives you 9 photos that means there are more photos. Hence I find all the photos in the album.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#for each post from the previous block that has attachments</span>
</span><span class='line'><span class="n">photo_ids</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="o">[</span><span class="s2">&quot;photo&quot;</span><span class="o">][</span><span class="s2">&quot;fbid&quot;</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'><span class="k">if</span> <span class="n">photo_ids</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">9</span>
</span><span class='line'>  <span class="c1"># get data for first photo</span>
</span><span class='line'>  <span class="nb">id</span> <span class="o">=</span> <span class="n">photo_ids</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>  <span class="n">photo_data</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://graph.facebook.com/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">?access_token=</span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">auth_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="c1">#parse album ID and get all photo id&#39;s for that album</span>
</span><span class='line'>  <span class="n">album_id</span> <span class="o">=</span> <span class="n">photo_data</span><span class="o">[</span><span class="s2">&quot;link&quot;</span><span class="o">].</span><span class="n">match</span><span class="p">(</span><span class="sr">/(a\.)([^\.]+)/</span><span class="p">)</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://graph.facebook.com/</span><span class="si">#{</span><span class="n">album_id</span><span class="si">}</span><span class="s2">/photos?fields=id&amp;access_token=</span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">auth_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">photo_ids</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s2">&quot;data&quot;</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I get the photo_ids from the first line, and if there are 9 which means more photos I get all photo IDs from the album.
Iterating over all the photo ID&rsquo;s to get the related informaton:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">photo_ids</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
</span><span class='line'>  <span class="n">photo_data</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://graph.facebook.com/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">?access_token=</span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">auth_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="c1">#and for comments </span>
</span><span class='line'>  <span class="k">if</span> <span class="n">photo_data</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s2">&quot;comments&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">photo_data</span><span class="o">[</span><span class="s2">&quot;comments&quot;</span><span class="o">][</span><span class="s2">&quot;data&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span>
</span><span class='line'>      <span class="c1">#use comment information</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see there&rsquo;s a lot of edge cases here, so you must test thoroughly. Both manually and with automated tests. One good thing about the photo query is that it gives you comment information too. The following takes care of status updates, comments on them, photos posted on the wall, comments to those and if the user posts an album. The only part I haven&rsquo;t been able to get is realtime comment on a photo which is inside an album. I am currently working on that, and will update this post if I find a way.</p>

<h3>Wrapping it all up.</h3>

<p>Despite it&rsquo;s limitations Facebook has done a great job with the realtime updates and <a href="https://developers.facebook.com/docs/reference/fql/">Facebook Query Language</a>. I can&rsquo;t stress this point enough, test thoroughly. Manually and with automated testing such as Rspec. I have written tests for this and might showcase it in a later blog post. Whenever you get stuck, instead of searching StackOverflow which at times can help, the best approach I found is to use the <a href="https://developers.facebook.com/tools/explorer">Graph Explorer</a>.</p>

<p>Hope that was useful, let me know if you have any questions.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creating a Secure and Versioned API in Rails]]></title>
    <link href="http://shivamd.github.io/blog/2013/11/01/creating-a-secure-and-versioned-api-in-rails/"/>
    <updated>2013-11-01T23:55:00+04:00</updated>
    <id>http://shivamd.github.io/blog/2013/11/01/creating-a-secure-and-versioned-api-in-rails</id>
    <content type="html"><![CDATA[<p>Been working on a side project with a friend and we were at the point where we needed to build an API for the code we had written. The idea was to build an API which can be accessed by our customers with an API key.</p>

<p>After some research, I found couple  of gems that make it easy to do this. <a href="https://github.com/filtersquad/rocket_pants">Rocket Pants</a> and <a href="https://github.com/bploetz/versionist">Versionist</a>. In order to reduce the dependencies, I decided to build it myself with the help of <a href="https://railscasts.com">RailsCasts</a>.</p>

<h3>Creating the API.</h3>

<p>We will start off by creating the routes for it.</p>

<figure class='code'><figcaption><span>config/routes.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">namespace</span> <span class="ss">:api</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">namespace</span> <span class="ss">:v1</span> <span class="k">do</span>
</span><span class='line'>     <span class="n">namespace</span> <span class="ss">:search</span> <span class="k">do</span>
</span><span class='line'>       <span class="n">get</span> <span class="s2">&quot;youtube&quot;</span>
</span><span class='line'>     <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This block of code gives us the following route:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/api/v1/search/youtube</span></code></pre></td></tr></table></div></figure>


<p>Now in order to create the controller, since they are namespaced under api and the version number you must put the controller inside the two modules.</p>

<figure class='code'><figcaption><span>app/controllers/api/v1/search_controller.rb</span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Api</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">V1</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">SearchController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">youtube</span>
</span><span class='line'>        <span class="c1">#code that searches for youtube videos</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now doing the following should give you a list of YouTube results in a JSON format.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl yoururl.com/api/v1/search/youtube?query<span class="o">=</span>funny
</span></code></pre></td></tr></table></div></figure>


<p>This setup gives us the ability to easily add new versions of the API while maintaining backwards compatibility. The only thing is that the API is not secure.</p>

<h3>Securing the API.</h3>

<p>There are a few ways you can do this. Instead of doing it with OAuth I just created an access token given to each application created. The access token is created using a SecureRandom.hex string.</p>

<figure class='code'><figcaption><span>app/models/user.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="c1">#code for authentication </span>
</span><span class='line'>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:applications</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/models/application.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">before_create</span> <span class="ss">:generate_access_token</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:user</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">generate_access_token</span>
</span><span class='line'>    <span class="k">begin</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">hex</span>
</span><span class='line'>    <span class="k">end</span> <span class="k">while</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="n">access_token</span><span class="p">:</span> <span class="n">access_token</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The way I set this up is that a user can have many applications, and each application belongs to a user. Before an application is created there is a unique key which is generated restricing access to the API.
There are other columns you can add to the model if needed such as permissions, expires_at etc.</p>

<figure class='code'><figcaption><span>app/controllers/api/v1/search_controller.rb</span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Api</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">V1</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">SearchController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>      <span class="n">before_filter</span> <span class="ss">:restrict_access</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">youtube</span>
</span><span class='line'>        <span class="c1">#code that searches for youtube videos</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">restrict_access</span>
</span><span class='line'>        <span class="n">app</span> <span class="o">=</span> <span class="no">Application</span><span class="o">.</span><span class="n">find_by_access_token</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:access_token</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="n">head</span> <span class="ss">:unauthorized</span> <span class="k">unless</span> <span class="n">app</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Updating the controller in order to send an unauthorized response if the access key is invalid. Now in order to make a request the user has to send in the right access_token in the parameters. Also make sure to not make the access_token field accessible using attr_accessible or in rails 4 you can do the following:</p>

<figure class='code'><figcaption><span>app/controllers/applications.rb</span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="c1">#code for controller</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="vi">@application</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">application_params</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">#code to save application</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">application_params</span>
</span><span class='line'>    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:application</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instead of directly passing in the params[:application] we pass the build method a method itself. This private method makes sure to only permit the application name.</p>

<p>Since the output of my controllers were already in JSON there was no need for <a href="https://github.com/nesquena/rabl">RABL</a>. Also for those looking for something lightweight can have a look at <a href="https://github.com/rails-api/rails-api">Rails-API</a>. This is enough to get you started if you any questions leave comments and I shall address them.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How many lines of code is your project?]]></title>
    <link href="http://shivamd.github.io/blog/2013/09/11/your-code-statistics/"/>
    <updated>2013-09-11T00:34:00+04:00</updated>
    <id>http://shivamd.github.io/blog/2013/09/11/your-code-statistics</id>
    <content type="html"><![CDATA[<p>A client just asked me, how many lines of code is the project?
Despite being an absurd question, and having no relation with the project at all this made me really curious to find out.
After a quick web search, I stumbled upon this piece of code (Bare in find this is for a rails app).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find ./app -type f | xargs cat | wc -l</span></code></pre></td></tr></table></div></figure>


<p>What does this code do?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find</span></code></pre></td></tr></table></div></figure>


<p> is a shell method that searches through the files.
The next part,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./app -type f</span></code></pre></td></tr></table></div></figure>


<p> searches the app directory. You can search any directory you want, this looks at the app directory which in a rails app holds majority of the code you write.
After that you list the type you want. If you search without the type you get both directories and files. In this case we just want files, hence the &ldquo;f&rdquo;. This is an alias for &ldquo;file&rdquo;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| xargs</span></code></pre></td></tr></table></div></figure>


<p>We need to use xargs over here which reads the STDIN stream data and coverts each line into space separated arguments to the command.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat |</span></code></pre></td></tr></table></div></figure>


<p>reads the output and pipes it out to the next step of commands</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wc -l</span></code></pre></td></tr></table></div></figure>


<p>&ldquo;wc&rdquo; is short for word count. This gives 3 results. The first being the number of new lines, the second being the number of words and last the number of characters. However we are interested in the lines, hence the command &ldquo;-l&rdquo;.
This is a cool little script to get an overview of the size of the codebase.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Advice to people learning how to code]]></title>
    <link href="http://shivamd.github.io/blog/2013/08/24/advice-to-people-learning-how-to-code/"/>
    <updated>2013-08-24T01:37:00+04:00</updated>
    <id>http://shivamd.github.io/blog/2013/08/24/advice-to-people-learning-how-to-code</id>
    <content type="html"><![CDATA[<p>There is a lot of advice thrown out there to people who are just starting out to learn how to program. The learning never stops. It&rsquo;s been a crazy journey over the past two years, from spending countless hours alone trying to learn things by myself. To enrolling into a <a href="http://bloc.io">Bloc</a> course and then finally the intensive 12 weeks of <a href="http://devbootcamp.com">Dev Bootcamp</a>. Now I am a contract web developer who is tackling challenging problems, learning new things on a daily basis and loving every moment of it.</p>

<p>So what is my piece of advice? Build things. There is no secret formula, book or programming language. The only way to improve is to build things. I don&rsquo;t care what programming language you use (<a href="http://www.ruby-lang.org/en/">Ruby</a> is awesome), just build things. Half baked things, things people would use or things you want to use. Basically anything!</p>

<p>I&rsquo;ll be honest with you. I wasted the starting months while learning. I kept devouring new books, latest challenges of <a href="http://codecademy.com">codecademy</a> and anything that kept me away from uncertainty. This just filled my ego. I wasn&rsquo;t progressing as a programmer, I was just getting comfortable with syntax. I was lying to myself that I was improving. The bottom line is, the only way to improve is to build things.</p>

<h3>I have a lot of time but I don&rsquo;t know what to build.</h3>

<p>Stop feeding yourself excuses. You use a lot of websites on a daily basis. How about build a clone of it? Try exercising different muscles.
Want some ideas?</p>

<ul>
<li>  <a href="http://www.dreamincode.net/forums/topic/78802-martyr2s-mega-project-ideas-list/">Martyr2&rsquo;S Mega Project Ideas List</a></li>
<li>  <a href="http://jenniferdewalt.com/">180 websites in 180 days</a></li>
</ul>


<p>Your task over here is not to make money with these things, I am not saying you can&rsquo;t, but your main focus should be to get as much experience under your belt as possible.</p>

<h3>I don&rsquo;t have enough time.</h3>

<p>Lies. If this really matters to you, you will find time. Skip an episode of your favorite TV show, don&rsquo;t go out for that movie or cancel a night out. Carve out a set time couple of times a week, more if you can. And just code. Think of it as an appointment that you can&rsquo;t miss, nothing else matters during those hours.</p>

<p>You are not doing this to get a job or to make your <a href="http://github.com">github</a> look impressive. It can, but your main objective here is to get better at coding. The idea here is to level up, tackle areas you are unfamiliar about and embrace the uncertainty. It&rsquo;s very easy to keep building things that don&rsquo;t stretch your skill level.</p>

<p>Go code. Don&rsquo;t think about writing code, just code.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The world is ready for my thoughts.]]></title>
    <link href="http://shivamd.github.io/blog/2013/05/11/the-world-is-ready-for-my-thoughts/"/>
    <updated>2013-05-11T12:36:00+04:00</updated>
    <id>http://shivamd.github.io/blog/2013/05/11/the-world-is-ready-for-my-thoughts</id>
    <content type="html"><![CDATA[<p>I turned around to Stephane and said, &ldquo;I think the world is ready for my thoughts.&rdquo; He said, you mean you are ready to expose your thoughts to the world. I thought about that for a second, and realized how true that is. I have been wanting to start a blog since a year now, but I kept delaying it because I was afraid about what people might think. In reality nobody cares about you, all they think about is themselves.
Enough of that bullshit. I have finally reached a state of mind, where I don&rsquo;t mind putting myself out there.</p>

<h2>Tell me about Yourself.</h2>

<p>The interview question I dread.
Recently graduated from high school in Dubai. Wandered for a few months and initially decided to not follow the traditional path of college. Completed Dev Bootcamp, a 9 week intensive course on web development, on April 19th 2013. Currently an aspiring web developer. I love learning and exploring new things.
This is a brief overview of my journey over the past couple of years, read the whole account here.</p>

<p>My writings are going to be about the things I learn and my ramblings. Mainly about my journey as a software developer.</p>
]]></content>
  </entry>
  
</feed>
